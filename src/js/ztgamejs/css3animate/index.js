import PREFIX from"../prefix/index";import $ from"jquery";import Device from"../device/index";import Utli from"../utli/index";/**
    @author:pengzai
    @blog:http://pengzai.dev
    @github:https://github.com/pengzai-dev
**/var support_css3=Device.support_css3;function upFirst(a){// str = str.toLowerCase();
var b=a.split(" "),c="";for(var d in b)c+=b[d].substring(0,1).toUpperCase()+b[d].substring(1)+"";return c}var css3unit={deg:["rotate(.*)","skew(.*)"],px:["width","height","x","y","translate(.+)","margin(.*)","padding(.+)"]};//var transformStyle = ["scale", "rotate", "translate", "skew", "perspective"];
// function istransformstyle(style) {
//     if (style == "x" || style == "y" || style == "z") {
//         style = "translate";
//     }
//     for (var i in transformStyle) {
//         if (isSameStyle(style, transformStyle[i])) {
//             return true;
//         }
//     }
//     return false;
// }
// function isSameStyle(str1, str2) {
// 	if (str1.toLowerCase() == str2.toLowerCase()) {
// 		return true;
// 	} else {
// 		return false;
// 	}
// }
function getUnit(a){var b,c="";for(var d in css3unit)for(var e in b=css3unit[d],b)if(-1<b[e].indexOf("(")){if(a.match(new RegExp(b[e],"ig")))return c="no"==d?"":d,c;}else if(b[e]==a)return c="no"==d?"":d,c;return c}function css3format(a){var b,c="",d="50% 50%",e={};for(var f in a){b=a[f];// console.log(i);
var g=getUnit(f);isNaN(b)||(b+=g);"translate"==f?c+="translate("+b+","+b+") ":"x"===f?c+="translateX("+b+") ":"y"===f?c+="translateY("+b+") ":"z"===f?c+="translateZ("+b+") ":"scaleX"===f?c+="scaleX("+b+") ":"scaleY"===f?c+="scaleY("+b+") ":"scaleZ"===f?c+="scaleZ("+b+") ":"scale"===f?c+="scale("+b+") ":"rotate"===f?c+="rotate("+b+") ":"rotateX"===f?c+="rotateX("+b+") ":"rotateY"===f?c+="rotateY("+b+") ":"rotateZ"===f?c+="rotateZ("+b+") ":"skewX"===f?c+="skewX("+b+") ":"skewY"===f?c+="skewY("+b+") ":"skew"===f?c+="skew("+b+") ":"perspective"===f?c+="perspective("+b+") ":"origin"===f?d=b:e[f]=b}return{origin:d,transform:c,css2:e}}function getCss3(a){a=Utli.query(a);// console.log(element);
var b=a.style[PREFIX.js+"Transform"];if(!b)return{};var c,d,e,f=b.split(" "),g={};for(var h in f){if(e=f[h].split("("),2>e.length)break;c=$.trim(e[0]),"translateX"==c&&(c="x"),"translateY"==c&&(c="y"),"translateZ"==c&&(c="z"),d=$.trim(e[1].replace(")","").replace("px","")),g[c]=d}return g}function setcss3(a,b,c){if(a=Utli.query(a),!!a){if(a instanceof Array){for(var d in a)setcss3(a[d],b,c);return}a.style[PREFIX.js+upFirst(b)]=c,a.style[b]=c}}function setStyle(a,b,c,d){if(a=Utli.query(a),!!a){if(a instanceof Array){for(var e in a)setStyle(a[e],b,c,d);return}if("undefined"==typeof c?c=!1:"function"==typeof c&&(callback=c,c=!1),!c&&support_css3("transition")){$(a).css("transition","all 0s linear "),$(a).css(PREFIX.css+"transition","all 0s linear ")}var f=getCss3(a),g=css3format($.extend(f,b));a.style[PREFIX.css+"transform"]=g.transform,$(a).css(PREFIX.css+"transform-origin",g.origin),d||$(a).css(g.css2)}}function pauseanimation(a){support_css3("animation")&&(a=Utli.query(a),a&&setcss3(a,"animationPlayState","paused"))}function resumeanimation(a){support_css3("animation")&&setcss3(a,"animationPlayState","running")}function stopanimation(a){support_css3("animation")&&(a=Utli.query(a),a&&(setcss3(a,"animationPlayState","paused"),setcss3(a,"animationName","none"),setcss3(a,"animationDuration",0),setcss3(a,"animationTimingFunction","linear"),setcss3(a,"animationDelay",0),setcss3(a,"animationIterationCount","none"),setcss3(a,"animationDirection","none"),setcss3(a,"animationFillMode","none")))}function runanimation(a,b,c,d){if((a=Utli.query(a),!!a)&&"undefined"!=typeof b&&b){if("undefined"!=typeof c&&c?"function"==typeof c&&(d=c,c={}):c={},!support_css3("animation"))return void("function"==typeof d&&d());if(a instanceof Array){var e=null;for(var f in a)f!=a.length-1||!d||(e=d),runanimation(a[f],b,c,e);return}c=$.extend({speed:400,easing:"linear",count:1,delay:0,direction:"normal",fillmode:"both"},c),isNaN(c.speed)||(c.speed+="ms"),isNaN(c.delay)||(c.delay+="ms");var g=d;setcss3(a,"animationName",b),setcss3(a,"animationDuration",c.speed),setcss3(a,"animationTimingFunction",c.easing),setcss3(a,"animationDelay",c.delay),setcss3(a,"animationIterationCount",c.count),setcss3(a,"animationDirection",c.direction),setcss3(a,"animationPlayState","running"),setcss3(a,"animationFillMode",c.fillmode),d="undefined"==typeof d?function(){}:function(){a.removeEventListener(PREFIX.js+"AnimationEnd",d,!1),a.removeEventListener("animationend",d,!1),setTimeout(function(){"function"==typeof g&&g()})},a.addEventListener(PREFIX.js+"AnimationEnd",d,!1),a.addEventListener("animationend",d,!1)}}function nopx(a){return a?a.toString().replace("px",""):""}function hasSameStyle(a,b){if("object"!=typeof b||!a)return!1;var c=getCss3(a),d=!0;for(var e in b)if(b[e]!=c[e]&&nopx(b[e])!=nopx($(a).css(e))){d=!1;break}return d}function css3animate(a,b,c,d,e){if(a=Utli.query(a),a&&b){if("undefined"==typeof c?(c=400,d="linear"):"function"==typeof c&&(e=c,c=400,d="linear"),"undefined"==typeof d&&(d="linear"),"function"==typeof d&&(e=d,d="linear"),a instanceof Array){var f;for(var g in a)g!=a.length-1||!e||(f=e),css3animate(a[g],b,c,d,f);return}if(!support_css3("transform"))return void $(a).animate(b,c,d,e);//判断是否已经是当前的属性
if(!support_css3("transition"))return setStyle(a,b,!0,!0),void $(a).animate(b,c,d,e);if(hasSameStyle(a,b))return void("function"==typeof e&&setTimeout(e,c));var h=e;e="undefined"==typeof e?function(){}:function(){a.removeEventListener("transitionend",e,!1),setTimeout(function(){"function"==typeof h&&h()})};//console.log(support_css3("transition"));
var i=c/1e3+"s",j="all "+i+" "+d;$(a).css("transition",j),$(a).css(PREFIX.css+"transition",j),setStyle(a,b,!0),a.addEventListener("transitionend",e,!1)}}var Animate={set:function(a,b){setStyle(a,b,!1)},getCss3:getCss3,to:css3animate,keyframe:{run:runanimation,pause:pauseanimation,resume:resumeanimation,stop:stopanimation}};export default Animate;
